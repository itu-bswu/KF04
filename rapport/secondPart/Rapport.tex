\documentclass[11pt,a4paper,titlepage]{article}
\usepackage{textcomp}
\usepackage[latin1]{inputenc}
\usepackage[danish]{babel}
\usepackage{graphicx}
\usepackage{fancyhdr}
\DeclareGraphicsExtensions{.pdf,.png,.jpg}

\newcommand{\class}[1]{\textsf{#1}}
\newcommand{\field}[1]{\textit{#1}}

\title{KF04 project report}
\author{
Group 12:\\
Jakob Melnyk\\
Niklas Hansen\\
Emil Juul Jacobsen\\
Filip Hjermind Jensen\\
Jens Dahl Møllerhøj\\
}

\date{May 3, 2011}
\begin{document}
\maketitle
\tableofcontents

\setlength{\parindent}{0pt}
\setlength{\parskip}{1.8ex plus 0.5ex minus 0.2ex}

\clearpage

\section{Features}
\label{Feat}
This chapter describes the features and functions, we have included in our Map
of Denmark project, part 2, Spring 2011.
\begin{itemize}
  \item
  Find shortest route
  \item
  Display path using blue highlighting
  \item
  Multiple pins
  \item
  Total distance
  \item 
  Estimated travel time 
  \item 
  Bike or car route
  \item 
  Remove a single pin by clicking
  \item 
  Remove all pins by using GUI button
\end{itemize}
\subsection{Find shortest route}
Our map is able to calculate the shortest route between two points. This is done
by clicking the map. Clicking the map places a pin at the clicked location. If
the user clicks on another part of the map, our map will show the shortest route
between those two locations, if possible.
\subsection{Display path using blue highlighting}
When the user has selected two or more locations, the map will show the shortest
route highlighted in blue. The algorithm we use for finding this route is pretty
fast, so a user will not feel annoyed by how long it takes.
\subsection{Multiple pins}
It is possible for a user to place multiple pins on the map. This is done in
similarly to finding the shortest route between two points. When any number of
pins are placed, the user can add additional ones. This will calculate the route
between the latest two pins placed. The route shown will be from pin
1->2->3->4..
\subsection{Total distance}
Our Map of Denmark program calculates the total distance of the route found, a
functionality that assists the end-user in planning their trip. This was
relatively simple to implement, but adds a big functionality.
\subsection{Estimated travel time}
As with the total travel distance, our Map of Denmark calculates the estimated
time it will take to travel the route found by our algorithm. This was
relatively easy to calculate and is a huge benefit for the end user.
\subsection{Bike or car route}
It is possible for the user to choose between a car route and a bike route. The
different options will make our algorithm consider what is possible to traverse
for both cars and bikes. It will make sure not to show small paths for cars and
not show highways for bikes.
\subsection{Remove a single pin}
To make it easier to use our Map of Denmark, we have it possible to remove a pin
by clicking on the location it was placed. This makes it possible for the end
user to clear up a tiny missclick without having to shut down the entire Map or
clearing all the pins the user has placed.
\subsection{Remove all pins}
In addition to enabling the user to remove a single pin by clicking on it, we
have also made it possible to remove all the pins currently placed. This can be
done by either pressing the ``c'' key on the keyboard or by clicking the button
on the graphical interface. This avoids the chore of clicking every single point
in order to start a new route planning.
\pagebreak
\section{Implementation}
\label{Impl}
This chapter describes our implementation of interesting methods and functions
in our Map of Denmark project, part 2, Spring 2011.
\subsection{Model}
In order to implement the mentioned pathfinding the \class{Model} has been
extended to include a list of \class{Edges}. These correspond to all the roads
that are in the current route. Whenever it recieves a new request to find a path
from one \class{Node} to another it uses the static method in the Dijkstra class
and adds the result to the list. When \class{Control} needs to draw the route it
uses a method that returns the entire route as Line objects relative to the view. This approach is identical to what we 
use when the \class{Control} requests all roads that should be drawn as the map
for a given view.

We have also included some statistics of the current route. These are calculated
by the \class{Model} since it's the object that primarliy handles the data. This
information can be calculated in linear time relative to the length of the current route since
the route is saved in memory when first found.
\subsection{Dijkstra}
1. Skrevet ud fra implementationen fra Algorithms men modificeret meget til vores benyttelse. IndexMinPQ er svagt modificeret fra Algorithms.
2. Beskrivelse generelt af Dijkstra.

We have made some rather big changes to the Dijkstra algorithm to make it fit our 
requirements. First of all we have replaced the arrays that holds edgeTo and distTo
with Maps so we can use our objects instead of integers. We have however not changed
anything in the \class{IndexMinPQ} implementation that takes integers as values, this is not
a problem though, since our nodes have a unique integer index.
Another major change in the Dijkstra code is that we have modified it to be a static
method instead of a seperate object. This way the classes using it will not have to
instantiate it before use.
To be able to evaluate the edges differently depending on the type of transportation
that the user has selected, we have created the \class{Evaluator} class. This must be passed to
the pathfinding and is responsible for transforming the \class{KrakEdge} to a value that can
be inserted into the priority queue.
An important part of the pathfinding is the exclusion of the roads that are unidirectional
in the opposite direction. This check is performed every time a road is going to be
added to the priority queue, if the road can't be used it will skip to the next.
It is important to note here that we have found an error in the data from krak. The
problem is that some of the roads at the highways are oriented in the wrong direction,
this implies that the pathfinding will avoid the highway because it will only be able
to use short stretches of it. In order to be able to use the highway we have inserted a
little snip of code that allows traveling on the highway even though it is facing the
wrong way. This cheat however, gives accurate routes since the access and exit roads are
without error and can only be entered from the right direction.

We we're implementing the A* variation of the Dijkstra algorithm, but had to cut it off
just before turning in since it didn't work reliably. The problem was with the heuristics
of the direct path that the A* code consists of, it worked well when only using distance
as the measure of best path, but when opening up for more complicated evaluations of the
road (ex. drive time) it didn't work properly.

\subsection{Control}
A lot has changed in \class{Control} since our last version. We have changed a
lot of methods to work as static methods in a seperate \class{Tools} class, so
\class{Control} will feel less cluttered in this version. 
New logic has taken
the place of the old logic however. Route calculation, pin placement, pin
removal and route display all goes through \class{Control}.

When a user clicks on the map, \class{Control} uses our \class{Tools} class to
convert the screen coordinates to UTM coordinates. It then stores these in a
\class{List}. 
If the list holds two or more elements, it asks the \class{Model}
to calculate the shortest path between the first and second element, the second
and third element and so on, if any additional elements exist beyond the first
two. 
Every time \class{Control} calls it's internal repaint method, it clears
all the pins currently in the \class{View}. It then recalculates the pin
position(s) according to the new size and postion of the \class{View}.

When a user takes advantage of one of the options to clear all the pins
currently on the Map of Denmark, \class{Control} empties the collection holding
all the pin points, asks \class{Model} to clear the route and asks \class{View}
to repaint.

If a user removes a single pin by clicking on the location of the pin, we run
through our collection and remove one of the pins within a specific range of
pixels. It then makes \class{Model} recalculate the route for all the pins. This
is not an effective implementation - if there are a lot of pins, then removing
one might make the recalculating take a while. We decided to use this
implementation, for now at least, because we wanted a working functionality
that we could later improve upon if nessecary.
\subsection{Car/Bike routes}
Another useful feature we have included is the ability to switch between multiple
modes of pathfinding. We have named these two modes Car and Bike. In the Car mode
the pathfinding will priorize lower travel times, since we believe this to be most
important when driving. Additionally the Car mode will exclude small paths and 
pedestrian zones.
The Bike mode prioritizes lower distances highest since intersections and speed-limits
are of relatively low importance here. When using Bike mode the route will not include
highways.

As described earlier these different ways of prioritizing the roads are achieved by
using the \class{Evalutator} that is provided when asking the pathfinding
method for a best path. We have written these two evaluators as static objects
on the \class{Evaluator} class for easy use in the code, but the use of a
seperate object for the evaluations open up for later variation with little impact on the original code.
\subsection{View}
When looking at the changes in \class{View} relatively little has happened since
most of the new code is located "behind the curtain". The \class{Canvas} has
been extended to allow adding and drawing of the route. This is however, as mentioned earlier, done in exactly the same way
as with the roads in the map itself. The \class{Canvas} also includes some
points that is positions where the pins are placed. These are drawn on top of the map and (like the map)
needs provided again if the map moves.

When looking at the menu to the left there are a few more options to the user. There is a
new button to remove all pins from the map and two \class{RadioButtons} to
toggle between Car mode and Bike mode in the pathfinding.

Beneath the tools for pathfinding there are displayed two pieces of information (and
spare space for more). This information is changed by a simple public method in the View
and the units will adjust will be adjusted accordingly.
\pagebreak
\end{document}